name: Sync Google Sheet → CSV

on:


  schedule:
    - cron: "0 * * * *"   # every hour (change if needed)
  workflow_dispatch:

permissions:
  contents: write

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Fetch Google Sheet as CSV
        run: |
          curl -L \
          "https://docs.google.com/spreadsheets/d/${{ secrets.SHEET_ID }}/gviz/tq?tqx=out:csv&sheet=${{ secrets.SHEET_TAB }}" \
          -o data/restaurants.csv

      - name: Commit updated CSV
        run: |
          git config user.name "sheet-sync-bot"
          git config user.email "sheet-sync-bot@users.noreply.github.com"

          git add data/restaurants.csv

          if git diff --cached --quiet; then
            echo "No changes detected — skipping commit"
          else
            git commit -m "Sync restaurants.csv from Google Sheet"
            git push
          fi

